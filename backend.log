[dotenv@17.2.1] injecting env (6) from .env -- tip: üõ†Ô∏è  run anywhere with `dotenvx run -- yourcommand`
‚ùå OpenAI API key not configured - AI analysis will use mock responses
Tax & Law AI Expert server running on http://localhost:3001
Make sure to set your OPENAI_API_KEY and TAVILY_API_KEY environment variables
Connected to PostgreSQL database
Database schema initialized successfully
Database initialized successfully
Upload request received
File received: test_lohnsteuer.pdf 1593 bytes
Starting text extraction
Starting text extraction for test_lohnsteuer.pdf (application/pdf)
Processing PDF buffer: test_lohnsteuer.pdf (1593 bytes)
üîç Attempting reliable PDF text extraction...
üîç Starting reliable PDF text extraction for: test_lohnsteuer.pdf
üêç Attempting Python PyPDF2 script...
‚úÖ Python script extracted 204 characters from 1 pages
üìù First 100 chars: Lohnsteuerbescheinigung 2024
Arbeitnehmer: Max Mustermann
Arbeitgeber: Musterfirma GmbH
Bruttoarbeit...
‚úÖ Successfully extracted 204 characters from PDF
Successfully extracted 258 characters from test_lohnsteuer.pdf
Attempting to save document to database
Document saved to database with ID: 9
üìä Storing document 9 in Qdrant...
Error generating embedding: TypeError: Cannot read properties of null (reading 'embeddings')
    at generateEmbedding (file:///workspace/0711-Steuerberater/api/index.js:117:35)
    at storeDocumentInQdrant (file:///workspace/0711-Steuerberater/api/index.js:134:29)
    at file:///workspace/0711-Steuerberater/api/index.js:900:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
‚ùå Error storing document 9 in Qdrant: TypeError: Cannot read properties of null (reading 'embeddings')
    at generateEmbedding (file:///workspace/0711-Steuerberater/api/index.js:117:35)
    at storeDocumentInQdrant (file:///workspace/0711-Steuerberater/api/index.js:134:29)
    at file:///workspace/0711-Steuerberater/api/index.js:900:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
Failed to store in Qdrant (non-critical): TypeError: Cannot read properties of null (reading 'embeddings')
    at generateEmbedding (file:///workspace/0711-Steuerberater/api/index.js:117:35)
    at storeDocumentInQdrant (file:///workspace/0711-Steuerberater/api/index.js:134:29)
    at file:///workspace/0711-Steuerberater/api/index.js:900:19
    at process.processTicksAndRejections (node:internal/process/task_queues:105:5)
Sending response
üîç Semantic search request: "Lohnsteuer"
üîç Searching Qdrant for: "Lohnsteuer"
Error generating embedding: TypeError: Cannot read properties of null (reading 'embeddings')
    at generateEmbedding (file:///workspace/0711-Steuerberater/api/index.js:117:35)
    at searchDocumentsInQdrant (file:///workspace/0711-Steuerberater/api/index.js:172:34)
    at file:///workspace/0711-Steuerberater/api/index.js:1075:35
    at Layer.handle [as handle_request] (/workspace/0711-Steuerberater/node_modules/express/lib/router/layer.js:95:5)
    at next (/workspace/0711-Steuerberater/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/workspace/0711-Steuerberater/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/workspace/0711-Steuerberater/node_modules/express/lib/router/layer.js:95:5)
    at /workspace/0711-Steuerberater/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/workspace/0711-Steuerberater/node_modules/express/lib/router/index.js:346:12)
    at next (/workspace/0711-Steuerberater/node_modules/express/lib/router/index.js:280:10)
‚ùå Error searching Qdrant: TypeError: Cannot read properties of null (reading 'embeddings')
    at generateEmbedding (file:///workspace/0711-Steuerberater/api/index.js:117:35)
    at searchDocumentsInQdrant (file:///workspace/0711-Steuerberater/api/index.js:172:34)
    at file:///workspace/0711-Steuerberater/api/index.js:1075:35
    at Layer.handle [as handle_request] (/workspace/0711-Steuerberater/node_modules/express/lib/router/layer.js:95:5)
    at next (/workspace/0711-Steuerberater/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/workspace/0711-Steuerberater/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/workspace/0711-Steuerberater/node_modules/express/lib/router/layer.js:95:5)
    at /workspace/0711-Steuerberater/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/workspace/0711-Steuerberater/node_modules/express/lib/router/index.js:346:12)
    at next (/workspace/0711-Steuerberater/node_modules/express/lib/router/index.js:280:10)
Qdrant search failed: TypeError: Cannot read properties of null (reading 'embeddings')
    at generateEmbedding (file:///workspace/0711-Steuerberater/api/index.js:117:35)
    at searchDocumentsInQdrant (file:///workspace/0711-Steuerberater/api/index.js:172:34)
    at file:///workspace/0711-Steuerberater/api/index.js:1075:35
    at Layer.handle [as handle_request] (/workspace/0711-Steuerberater/node_modules/express/lib/router/layer.js:95:5)
    at next (/workspace/0711-Steuerberater/node_modules/express/lib/router/route.js:149:13)
    at Route.dispatch (/workspace/0711-Steuerberater/node_modules/express/lib/router/route.js:119:3)
    at Layer.handle [as handle_request] (/workspace/0711-Steuerberater/node_modules/express/lib/router/layer.js:95:5)
    at /workspace/0711-Steuerberater/node_modules/express/lib/router/index.js:284:15
    at Function.process_params (/workspace/0711-Steuerberater/node_modules/express/lib/router/index.js:346:12)
    at next (/workspace/0711-Steuerberater/node_modules/express/lib/router/index.js:280:10)
Falling back to database text search...
Connected to PostgreSQL database
üìù Fallback search found 4 documents
